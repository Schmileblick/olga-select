let defaultOptions={placeholder:"Select an option",selectedplaceholder:"selected",searchplaceholder:"Search",config:{updatable:!1,sortable:!1,searchable:!1},classes:{select:["select"],dropdown:["modal"],search:["search"]}};export default class e{constructor(e,t){this.elem=e,this.options=Object.assign({},t||defaultOptions),this.placeholder=this.options.placeholder||"Select an option",this.selectedplaceholder=this.options.selectedplaceholder||"selected",this.searchplaceholder=this.options.searchplaceholder||"Search",this.updatable=this.options.config?.updatable||!1,this.sortable=this.options.config?.sortable||!1,this.searchable=this.options.config?.searchable||!1,this.selectClass=this.options.classes?.select||["select"],this.dropdownClass=this.options.classes?.dropdown||["modal"],this.searchClass=this.options.classes?.search||["search"],this.multiple=attr(this.elem,"multiple"),this.oSelect=null,this.allOptionItems=[],this.generate()}generate(){this.elem.classList.add("hidden"),this.getData(),this.createDropdown(),this.addEvents()}getData(){let e=this.elem.querySelectorAll("option"),t=[],s=[];e.forEach(e=>{let l={text:e.innerText,value:e.value,selected:null!==e.getAttribute("selected")};this.sortable&&l.selected?s.push(l):t.push(l)}),this.allOptionItems=this.sortable?s.concat(t):t}createDropdown(){let e=`<input type="text" class="${this.searchClass.join(" ")}" placeholder="${this.searchplaceholder}">`,t=`<span>${this.placeholder}</span>`,s=`<div class="${this.dropdownClass.join(" ")} dropdown hidden">`;this.searchable&&(s+=e),s+="<ul></ul>",s+="</div>";let l=`<div class="${this.selectClass.join(" ")} oselect">`;l+=t,l+=s,l+="</div>",this.elem.insertAdjacentHTML("afterend",l),this.oSelect=this.elem.nextElementSibling,this._addOptions()}addEvents(){if(this.oSelect.addEventListener("click",e=>this._showableModal(e)),this.oSelect.querySelectorAll("li").forEach(e=>e.addEventListener("click",t=>this._clickedOption(t,e))),this.searchable){let e=this.oSelect.querySelector("input");e.addEventListener("keyup",()=>this._searchOptions(e.value))}modalSpacing(this.oSelect)}_addOptions(){let e=this.oSelect.querySelector("ul");this.allOptionItems.forEach(t=>{e.appendChild(this._addOption(t))})}_addOption(e){let t=document.createElement("li");return t.innerText=e.text,t.dataset.value=e.value,e.selected&&t.classList.add("selected"),t}_showableModal(e){let t=this.oSelect.querySelector(".dropdown");(e.target===this.oSelect||e.target===this.oSelect.querySelector("span"))&&(t.classList.contains("hidden")?t.classList.remove("hidden"):t.classList.add("hidden"),this.updatable&&!t.classList.contains("hidden")&&this._update()),window.addEventListener("click",e=>this._clickOutsideModal(e,t),!0)}_clickedOption(e,t){e.preventDefault(),this.multiple?this._isMultiple(t):this._isNotMultiple(t),this._changePlaceholder(),this.searchable&&this._resetSearch()}_searchOptions(e){this.oSelect.querySelectorAll("li").forEach(t=>{t.innerText.includes(e)?t.classList.contains("hidden")&&t.classList.remove("hidden"):t.classList.contains("hidden")||t.classList.add("hidden")})}_clickOutsideModal(e,t){e.target===this.oSelect||e.target===t||t.contains(e.target)||t.classList.contains("hidden")||t.classList.add("hidden")}_changePlaceholder(){let e=this.elem.querySelectorAll("option"),t=getNumberOfSelectedOptions(e);this.multiple&&t>1?this.oSelect.querySelector("span").innerText=`${t} ${this.selectedplaceholder}`:!this.multiple||this.multiple&&1===t?this.oSelect.querySelector("span").innerText=getSelectedOption(e).innerText:this.oSelect.querySelector("span").innerText=this.placeholder}_isMultiple(e){e.classList.contains("selected")?(e.classList.remove("selected"),this.elem.querySelector(`option[value="${e.dataset.value}"]`).removeAttribute("selected")):(e.classList.add("selected"),this.elem.querySelector(`option[value="${e.dataset.value}"]`).setAttribute("selected","selected"))}_isNotMultiple(e){this.oSelect.querySelectorAll("li").forEach(e=>{e.classList.remove("selected"),this.elem.querySelector(`option[value="${e.dataset.value}"]`).removeAttribute("selected")}),e.classList.add("selected"),this.elem.querySelector(`option[value="${e.dataset.value}"]`).setAttribute("selected","selected")}_resetSearch(){this.oSelect.querySelector("input").value="";this.oSelect.querySelectorAll("li").forEach(e=>{e.classList.contains("hidden")&&e.classList.remove("hidden")})}_update(){this.getData(),this.oSelect.querySelector("ul").innerHTML="",this._addOptions(),this.oSelect.querySelectorAll("li").forEach(e=>e.addEventListener("click",t=>this._clickedOption(t,e))),this._changePlaceholder()}};let attr=(e,t)=>void 0!==e[t]?e[t]:e.getAttribute(t),getNumberOfSelectedOptions=e=>{let t=0;return e.forEach(e=>{e.selected&&t++}),t},getSelectedOption=e=>{for(let t of e)if(t.selected)return t;return e[0]},modalSpacing=e=>e.querySelector(".dropdown").style.marginTop=`${e.offsetHeight+4}px`;