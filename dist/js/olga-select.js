export function oSelect(e,t){let l=oSelectDivSelectElem(e,t.placeholder),n=oSelectDropdownElem(t.classes.dropdown),s=oSelectListElem(e,l,t.multiple_placeholder),c=oSelectSearchElem(s,t.classes.search,t.search_placeholder);n.append(c),n.append(s),l.append(n),l.addEventListener("click",e=>dropdownEvent(e,l,n,t.placeholder)),insertAfter(l,e)}function oSelectDivSelectElem(e,t){let l=document.createElement("div");l.classList=e.classList,l.classList.add("oselect");let n=document.createElement("span");return n.dataset.oselectPlaceholder=n.textContent=l.ariaPlaceholder=t,l.append(n),l}function oSelectDropdownElem(e){let t=document.createElement("div");return t.dataset.oselectDropdown="",e.forEach(e=>t.classList.add(e)),t.classList.add("hidden"),t}function oSelectListElem(e,t,l){let n=document.createElement("ul");for(let s of e.options)n.append(oSelectOptionElem(e,t,s,l));return sortSelectedOptions(n),n}function oSelectSearchElem(e,t,l){let n=document.createElement("input");return n.placeholder=l,t.forEach(e=>n.classList.add(e)),n.addEventListener("keyup",()=>searchInList(n,e)),n}function oSelectOptionElem(e,t,l,n){let s=t.querySelector("[data-oselect-placeholder]"),c=document.createElement("li");c.textContent=l.text,c.dataset.value=l.value,l.selected&&c.classList.add("selected");let o=countSelectedOption(l);return l.selected&&e.multiple&&countSelectedOption(l)>1&&(s.dataset.oselectPlaceholder=s.textContent=`${o} ${n}`),(l.selected&&!e.multiple||l.selected&&e.multiple&&o<=1)&&(s.dataset.oselectPlaceholder=s.textContent=l.text),c.addEventListener("click",()=>optionEvent(c,e,l,s,n)),c}async function dropdownEvent(e,t,l,n){(e.target===t||e.target===t.querySelector("span"))&&(l.classList.contains("hidden")?(l.classList.remove("hidden"),await updateSelects(l,n)):l.classList.add("hidden"),dropdownSpacing(t,l)),closeListIfOutsideClick(t,l)}async function optionEvent(e,t,l,n,s){t.multiple?await optionEventIfMultiple(e,t,l,n,s):await optionEventIfNotMultiple(e,t,l,n),await resetSearchList(e.parentNode.parentNode.querySelector("input"),e.parentNode),sortSelectedOptions(e.parentNode)}function searchInList(e,t){let l=Array.from(t.querySelectorAll("li"));l.forEach(t=>{t.dataset.value.includes(e.value)?t.classList.contains("hidden")&&t.classList.remove("hidden"):t.classList.contains("hidden")||t.classList.add("hidden")})}async function resetSearchList(e,t){let l=Array.from(t.querySelectorAll("li"));e.value="",l.forEach(e=>{e.classList.contains("hidden")&&e.classList.remove("hidden")})}function optionEventIfNotMultiple(e,t,l,n){if(!e.classList.contains("selected")){for(let s of e.parentNode.children)s.classList.contains("selected")&&s.classList.remove("selected");e.classList.add("selected"),t.selectedIndex=l.index,n.dataset.oselectPlaceholder=n.textContent=l.text}}function optionEventIfMultiple(e,t,l,n,s){e.classList.contains("selected")?(e.classList.remove("selected"),l.attributes.removeNamedItem("selected")):(e.classList.add("selected"),l.setAttribute("selected",!0));let c=countSelectedOption(l);if(c>1)n.dataset.oselectPlaceholder=n.textContent=`${c} ${s}`;else for(let o of e.parentNode.children)o.classList.contains("selected")&&(n.dataset.oselectPlaceholder=n.textContent=o.textContent)}function closeListIfOutsideClick(e,t){window.addEventListener("click",l=>{l.target===e||e.contains(l.target)||t.classList.contains("hidden")||t.classList.add("hidden")})}function updateSelects(e,t){let l=e.parentNode.parentNode.querySelector("select"),n=e.querySelector("ul");for(let s of(n.innerHTML="",l.options))n.append(oSelectOptionElem(l,e.parentNode,s,t));sortSelectedOptions(n)}function insertAfter(e,t){t.parentNode.insertBefore(e,t.nextSibling)}function dropdownSpacing(e,t){t.style.marginTop=`${e.offsetHeight+4}px`}function countSelectedOption(e){let t=0;for(let l of e.parentNode.children)l.selected&&t++;return t}function sortSelectedOptions(e){let t=Array.from(e.querySelectorAll("li")),l=t.filter(e=>e.classList.contains("selected")),n=t.filter(e=>!e.classList.contains("selected"));e.innerHTML="",l.forEach(t=>e.appendChild(t)),n.forEach(t=>e.appendChild(t))}